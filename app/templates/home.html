{% extends "base.html" %}

{% block content %}
<h2 class="mb-4">üõçÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏, –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ —Ç–æ–≤–∞—Ä–∞–º–∏</h2>

<!-- ================== –§–û–†–ú–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø –ö–õ–ò–ï–ù–¢–ê ================== -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('web.add_client') }}">
            {{ add_client_form.hidden_tag() }}

            <div class="row g-3">
                <div class="col-md-4">
                    {{ add_client_form.name.label(class="form-label") }}
                    {{ add_client_form.name(class="form-control") }}
                    {% if add_client_form.name.errors %}
                        {% for error in add_client_form.name.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="col-md-4">
                    {{ add_client_form.email.label(class="form-label") }}
                    {{ add_client_form.email(class="form-control") }}
                    {% if add_client_form.email.errors %}
                        {% for error in add_client_form.email.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="col-md-4">
                    {{ add_client_form.phone.label(class="form-label") }}
                    {{ add_client_form.phone(class="form-control") }}
                    {% if add_client_form.phone.errors %}
                        {% for error in add_client_form.phone.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="col-12 mt-3">
                    {{ add_client_form.submit(class="btn btn-primary w-100") }}
                </div>
            </div>
        </form>
    </div>
</div>

<!-- ================== –°–ü–ò–°–û–ö –ö–õ–ò–ï–ù–¢–û–í ================== -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">üë• –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã</h5>
    </div>
    <div class="card-body">
        {% if clients %}
            <table class="table table-sm table-hover">
                <thead>
                    <tr>
                        <th>Id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                        <th>–ò–º—è</th>
                        <th>Email</th>
                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                        <th>–ó–∞–∫–∞–∑–æ–≤</th>
                    </tr>
                </thead>
                <tbody>
                    {% for c in clients %}
                    <tr>
                        <td>{{ c.id }}</td>
                        <td>{{ c.name }}</td>
                        <td><code>{{ c.email }}</code></td>
                        <td>{{ c.phone or '-' }}</td>
                        <td>{{ c.orders | length }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="alert alert-info">–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ!</div>
        {% endif %}
    </div>
</div>

<!-- ================== –§–û–†–ú–ê –ó–ê–ö–ê–ó–ê ================== -->
<!-- ================== –§–û–†–ú–ê –ó–ê–ö–ê–ó–ê ================== -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('web.add_order') }}">
            <div class="row g-3">

                <div class="col-md-4">
                    {{ add_order_form.client_id.label(class_="form-label") }}
                    {{ add_order_form.client_id(class_="form-control", placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123") }}
                    {% if add_order_form.client_id.errors %}
                        {% for error in add_order_form.client_id.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="col-md-5">
                    {{ add_order_form.product_id.label(class_="form-label") }}
                    {{ add_order_form.product_id(class_="form-select", aria_label="–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä") }}
                    {% if add_order_form.product_id.errors %}
                        {% for error in add_order_form.product_id.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="col-md-2">
                    {{ add_order_form.quantity.label(class_="form-label") }}
                    {{ add_order_form.quantity(class_="form-control", type="number", min="1", max="999") }}
                    {% if add_order_form.quantity.errors %}
                        {% for error in add_order_form.quantity.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="col-12 mt-4">
                    {{ add_order_form.submit(class_="btn btn-success btn-lg w-100") }}
                </div>

            </div>
        </form>
    </div>
</div>
<!-- ================== –°–ü–ò–°–û–ö –ó–ê–ö–ê–ó–û–í ================== -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h5>
    </div>
    <div class="card-body">
        {% if orders %}
            <table class="table table-sm table-hover">
                <thead>
                    <tr>
                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                        <th>–¢–æ–≤–∞—Ä</th>
                        <th>–ö–æ–ª-–≤–æ</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–î–∞—Ç–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for o in orders %}
                    <tr>
                        <td>{{ o.client.name }}</td>
                        <td>{{ o.product.name }}</td>
                        <td>{{ o.quantity }}</td>
                        <td><strong>{{ o.total_price }} ‚ÇΩ</strong></td>
                        <td>{{ o.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="alert alert-info">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤. üõí –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</div>
        {% endif %}
    </div>
</div>

<!-- ================== –§–û–†–ú–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø –¢–û–í–ê–†–ê ================== -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('web.add_product') }}">
            {{ add_product_form.hidden_tag() }}

            <div class="row g-3">
                <div class="col-md-5">
                    {{ add_product_form.name.label(class="form-label") }}
                    {{ add_product_form.name(class="form-control") }}
                    {% if add_product_form.name.errors %}
                        {% for error in add_product_form.name.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="col-md-3">
                    {{ add_product_form.price.label(class="form-label") }}
                    {{ add_product_form.price(class="form-control") }}
                    {% if add_product_form.price.errors %}
                        {% for error in add_product_form.price.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="col-md-4">
                    {{ add_product_form.category.label(class="form-label") }}
                    {{ add_product_form.category(class="form-control") }}
                    {% if add_product_form.category.errors %}
                        {% for error in add_product_form.category.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="col-12 mt-3">
                    {{ add_product_form.submit(class="btn btn-success w-100") }}
                </div>
            </div>
        </form>
    </div>
</div>

<!-- ================== –°–ü–ò–°–û–ö –¢–û–í–ê–†–û–í ================== -->
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">üì¶ –í—Å–µ —Ç–æ–≤–∞—Ä—ã</h5>
    </div>
    <div class="card-body">
        {% if products %}
            <table class="table table-sm table-hover">
                <thead>
                    <tr>
                        <th>–¢–æ–≤–∞—Ä</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–ü—Ä–æ–¥–∞–Ω–æ</th>
                        <th>–í—ã—Ä—É—á–∫–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in products %}
                    <tr>
                        <td>{{ p.name }}</td>
                        <td><strong>{{ p.price }} ‚ÇΩ</strong></td>
                        <td>{{ p.category or '-' }}</td>
                        <td>{{ p.order_items | length }}</td>
                        <td>{{ p.order_items | sum(attribute='total_price') }} ‚ÇΩ</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="alert alert-info">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</div>
        {% endif %}
    </div>
</div>

<a href="{{ url_for('web.export') }}" class="btn btn-primary mt-3">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</a>

{% endblock %}